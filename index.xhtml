<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>7 minute workout timer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width = device-width, initial-scale = 1, user-scalable = no" />
    <style>

      body {
        color: red;
        margin 0 auto;
        padding-top: 1em;
        text-align: center;
        font-family: "Helvetica Nueue", sans-serif;
        font-size: 3em;
        font-weight: medium;
      }
      body.rest { color: green; }
      body.start {color: blue; }

      #start { cursor: pointer; }
      #timer { font-size: 2em; }
      #remaining {
        margin-top: 2em;
        font-size: 0.75em;
      }
    </style>
  </head>
  <body class="start">

    <div id="current">
      <a id="start" onclick="next()">
        Start â–¶
      </a>
    </div>

    <div id="timer"></div>
    <div id="remaining"></div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script>
      var routine = [
        'Jumping jacks',       // Whole body
        'Wall sit',            // Lower body
        'Push-ups',            // Upper body
        'Abdominal crunches',  // Core
        'Burpees',             // Whole body
        'Squat',               // Lower body
        'Tricep dips',         // Upper body
        'Superman stretch',    // Core
        'High knees running',  // Whole body
        'Lunges',              // Lower body 
        'Push-ups + rotation', // Upper body
        'Plank'                // Core
        ];

      var workTime = 30, restTime = 10;

      function next(){
        beep(); setTimeout(beep, 200); // beep twice
        var current = routine.shift();
        $('body').removeClass("start").removeClass("rest");
        $('#current').html(current);
        $('#remaining').html(routine.length + " to go");
        updateClock(workTime);
        setTimeout(rest, workTime * 1000);
      }

      function rest(){
        beep(2000, 0.5); // beep once, with a lower frequency
        $('body').addClass("rest");
        var upNext = routine[0];
        if (upNext !== null) {
          $('#current').html('Rest. ' + upNext + ' next.');
          updateClock(restTime);
          setTimeout(next, restTime * 1000);
        } else {
          $('#timer').hide();
          $('#current').html("Good job!");
        }
      }

      function updateClock(n){
        $('#timer').show().html(n);
        if (n > 1) {
          setTimeout(function() { updateClock(n-1); }, 1000);
        }
      }

      var beep = (function () {
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        return function (frequency, duration) {
          var oscillator = audioCtx.createOscillator();
          var gainNode = audioCtx.createGain(); // to control volume
          oscillator.connect(gainNode);
          gainNode.connect(audioCtx.destination);
          gainNode.gain.value = 0.1;
          oscillator.frequency.value = (frequency || 2500); // value in hertz
          oscillator.start(0);
          oscillator.stop(duration || 0.1); // stop after given delay (in seconds)
        };
      })();

    </script>
  </body>
</html>
